<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recetas PWA</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2d6a4f">
    <link rel="apple-touch-icon" href="icon-192.png">
</head>

<body>

    <div class="app-container">
        <header id="main-header">
            <h1 id="page-title">Mis Recetas</h1>
            <button id="header-action-btn" class="btn btn-secondary btn-icon hidden">
                <!-- Icon placeholder -->
                ‚Üê
            </button>
            <div id="user-section" style="margin-left: auto; display: flex; align-items: center; gap: 10px;">
                <span id="user-name" class="text-muted hidden" style="font-size: 0.8rem;"></span>
                <input id="file-import" type="file" accept=".csv" style="display:none" />
                <button id="btn-import-csv" class="btn btn-secondary" title="Importar CSV" style="padding:5px 8px; font-size:0.8rem;">üìÅ CSV</button>
                <button id="btn-login" class="btn btn-secondary"
                    style="padding: 5px 15px; font-size: 0.8rem;">G</button>
            </div>
        </header>

        <!-- NAVIGATION TABS -->
        <nav id="main-tabs" class="tabs-container">
            <button class="tab-btn active" data-tab="list">üìã Recetas</button>
            <button class="tab-btn" data-tab="pantry">üì¶ Despensa</button>
            <button class="tab-btn" data-tab="history">üïí Historial</button>
        </nav>

        <!-- VIEW: RECIPE LIST -->
        <main id="view-list" class="view-section active">
            <div id="recipe-list-container">
                <!-- Recipes injected here -->
                <div class="empty-state" style="text-align: center; padding: 40px; color: #888;">
                    <p>No hay recetas a√∫n.</p>
                    <p>¬°A√±ade una nueva!</p>
                </div>
            </div>

            <div class="bottom-actions" style="position: sticky; bottom: 20px; padding: 20px; pointer-events: none;">
                <button id="btn-generate-shop" class="btn"
                    style="pointer-events: auto; display: none; box-shadow: var(--shadow-lg);">
                    Generar Lista de Compra (<span id="selected-count">0</span>)
                </button>

                <button id="btn-add-recipe" class="btn fab"
                    style="pointer-events: auto; margin-left: auto; margin-top: 10px;">
                    +
                </button>
            </div>
        </main>

        <!-- VIEW: ADD RECIPE -->
        <main id="view-add" class="view-section">
            <div class="form-group">
                <label class="text-muted">Nombre de la Receta</label>
                <input type="text" id="recipe-name" placeholder="Ej. Lentejas Caseras">
            </div>

            <div style="margin-top: 20px;">
                <label class="text-muted">Ingredientes</label>
                <div id="ingredients-list">
                    <!-- Initial Row -->
                    <div class="ingredient-row">
                        <input type="text" placeholder="Ingrediente" class="ing-name">
                        <input type="number" placeholder="Cant." class="ing-qty">
                        <input type="text" placeholder="Unid." class="ing-unit">
                        <button class="btn btn-danger btn-icon" onclick="this.parentElement.remove()">√ó</button>
                    </div>
                </div>
                <button id="btn-add-ingredient" class="btn btn-secondary" style="margin-top: 10px;">+ A√±adir
                    Ingrediente</button>
            </div>

            <div style="margin-top: 40px; display: flex; gap: 10px;">
                <button id="btn-cancel-add" class="btn btn-secondary" style="flex:1">Cancelar</button>
                <button id="btn-save-recipe" class="btn" style="flex:2">Guardar Receta</button>
            </div>
        </main>

        <!-- VIEW: SHOPPING LIST -->
        <main id="view-shopping" class="view-section">
            <div class="shopping-summary"
                style="padding: 20px; background: #e9ecef; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="margin:0">Resumen de Compra</h3>
                <p class="text-muted">Ingredientes para <span id="shop-recipe-count">0</span> recetas.</p>
            </div>

            <!-- Shopping List Mode: View -->
            <div id="shopping-mode-view">
                <div id="shopping-list-items">
                    <!-- Items injected here -->
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button id="btn-back-list" class="btn btn-secondary" style="flex: 1;">Volver</button>
                    <button id="btn-start-purchase" class="btn"
                        style="flex: 1; background-color: var(--primary-color);">Finalizar Compra</button>
                </div>
            </div>

            <!-- Shopping List Mode: Complete Purchase -->
            <div id="shopping-mode-complete" class="hidden">
                <div class="alert-info"
                    style="background: #e3f2fd; padding: 10px; border-radius: 4px; margin-bottom: 15px; font-size: 0.9rem;">
                    Introduce la cantidad real que has comprado. Calcularemos lo que te sobra para la despensa.
                </div>
                <div id="shopping-confirm-items">
                    <!-- Confirm items injected here -->
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button id="btn-cancel-purchase" class="btn btn-secondary" style="flex: 1;">Cancelar</button>
                    <button id="btn-confirm-purchase" class="btn" style="flex: 1;">Confirmar y Guardar</button>
                </div>
            </div>
        </main>

        <!-- VIEW: PANTRY -->
        <main id="view-pantry" class="view-section">
            <div style="padding: 20px; background: #fff3cd; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="margin:0">Mi Despensa</h3>
                <p class="text-muted" style="margin: 5px 0 0 0;">Ingredientes disponibles.</p>
            </div>

            <div id="pantry-list">
                <!-- Pantry items injected here -->
                <p class="text-center text-muted">Tu despensa est√° vac√≠a.</p>
            </div>

            <div class="bottom-actions" style="position: sticky; bottom: 20px; padding: 20px; pointer-events: none; display: flex; gap: 10px;">
                <button id="btn-add-purchase" class="btn btn-secondary" style="pointer-events: auto; flex: 1;">
                    üìù A√±adir Compra
                </button>
                <button id="btn-add-pantry-item" class="btn fab" style="pointer-events: auto;">
                    +
                </button>
            </div>
        </main>

        <!-- VIEW: ADD PANTRY ITEM -->
        <main id="view-add-pantry" class="view-section">
            <div class="form-group">
                <label class="text-muted">Ingrediente</label>
                <input type="text" id="pantry-item-name" placeholder="Ej. Arroz">
            </div>

            <div class="form-group">
                <label class="text-muted">Cantidad</label>
                <input type="number" id="pantry-item-qty" placeholder="Ej. 2" step="0.1">
            </div>

            <div class="form-group">
                <label class="text-muted">Unidad</label>
                <input type="text" id="pantry-item-unit" placeholder="Ej. kg">
            </div>

            <div style="margin-top: 40px; display: flex; gap: 10px;">
                <button id="btn-cancel-add-pantry" class="btn btn-secondary" style="flex:1">Cancelar</button>
                <button id="btn-save-pantry-item" class="btn" style="flex:2">A√±adir a Despensa</button>
            </div>
        </main>

        <!-- VIEW: SELECT PURCHASE FROM HISTORY -->
        <main id="view-select-purchase" class="view-section">
            <div style="padding: 20px; background: #e3f8ff; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="margin:0">Selecciona una Compra</h3>
                <p class="text-muted" style="margin: 5px 0 0 0;">Elige del historial para a√±adir a tu despensa.</p>
            </div>

            <div id="purchase-selection-list">
                <!-- Purchase options injected here -->
            </div>
        </main>

        <!-- VIEW: CONFIRM PURCHASE QUANTITIES -->
        <main id="view-confirm-purchase-add" class="view-section">
            <div style="padding: 20px; background: #d1ecf1; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="margin:0">Ajustar Cantidades</h3>
                <p class="text-muted" style="margin: 5px 0 0 0;">Modifica las cantidades que vas a a√±adir a tu despensa.</p>
            </div>

            <div id="purchase-items-adjust">
                <!-- Items to adjust injected here -->
            </div>

            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button id="btn-cancel-purchase-add" class="btn btn-secondary" style="flex: 1;">Cancelar</button>
                <button id="btn-confirm-purchase-add" class="btn" style="flex: 1;">A√±adir a Despensa</button>
            </div>
        </main>

        <!-- VIEW: HISTORY -->
        <main id="view-history" class="view-section">
            <div style="padding: 20px; background: #e3f8ff; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="margin:0">Historial de Compras</h3>
                <p class="text-muted" style="margin: 5px 0 0 0;">Tus listas de compra guardadas.</p>
            </div>

            <div id="history-list">
                <!-- History items injected here -->
                <p class="text-center text-muted">No hay historial a√∫n.</p>
            </div>
        </main>

    </div>

    <!-- Firebase SDKs (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script src="app.js" defer></script>
    <script src="importer.js" defer></script>
</body>

</html>