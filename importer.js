const csvData = `Number,Name,Time,Brown onion,Tomatoes,Garlic gloves,Coriander (g),Mango chutney (g),Curry powder (g),Ground paprika (g),Tomato paste (g),Solid creamed coconut (g),Canned chickpeas (g),Basmati rice (g),Vegetable stock mix (g),Basil (g),Mozzarella ball (g),Courgette,Cheddar Cheese (g),Cherry tomatoes (g),Dried Basil (g),Tortiglioni (pasta) (g),Balsamic vinegar (g),Grated italian hard cheese (g),cannned tomatoes (g),lime,gem lettuce,smoked paprika (g),honey (g),mayonnaise (ml),chipotle paste (g),meatless farm mince (g),plain tortillas,red chilli,soy sauce (ml),mangetout (g),sugar snap peas (g),teasted sesame seed (g),hoisin sauce (g),fine green beans (g),spring onion,baby leaf spinach (g),chilli jam (g),toasted sesame oil (ml),ginger and garlic paste (g),meat free chicken bites (g),udon noodles (g),red onion,sweet potato,agave syrup (g),cornflour (g),cayenne pepper (g),carrot,rice vinegar (ml),chesnut mushrooms (g),smooth peanut butter (g),medium egg noodle nests (g),ground cumin (g),ground coriander (g),plain tofu (g),canned sweetcorn (g),lemon,aubergine,chinese rice wine (ml),pea shots (g),arborio rice (g),butternut squash cubes (g),pine nuts (g),red lentils (g),shredded kale (g),coconut yoghurt (g),Sriracha hot chilli sauce (ml),,steamed white basmati rice (g),ras el hanout (g),canned tomato frito (g),couscous (g),roasted garlic paste (g),ground turmenic (g),canned green lentils (g),portobelllo mushrooms (g),white cup mushrooms (g),midi cucumber ,baharat (g),parsley and mint (g),harissa paste (g),mint sauce (g),wholemeal pittas bread,,,,
9089,Spiced Tofu Sofritas Bowl With Tomato Salsa,20',,4,,20,,,,32,,,,,,,,,,,,,,,2,,18,,,,,,,60,,,,,,,,,,,,,,,,112,5,,,,,,18,9,560,300,,,,,,,,,,,,,600,,,,,,,,,,,,,,,,,,
9264,Fruity Moroccan-Style Chickpea Stew With Couscous,20',,4,,,,,,,,800,,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2,,,,,,,,,,,,,28,400,240,30,,,,,,,,,,,,,,
8430,Mushroom Biryani With Cucumber Raita,20',,,,,40,,,32,,,,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,600,,,,30,,,300,320,2,,,,,,,,,
9579,Baharat Meat-Free Mince Stew With Fruity Couscous,20',,,,,,,,64,,800,,22,,,,,,,,,,,,,,,,,400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,240,30,,,,,,28,20,40,,,,,,
8798,Butternut Squash Dal With Coconut Raita,20',,,,,,28,,,50,,,11,,,,,,,,,,,,,,,,,,,2,,,,,,,,160,,,30,,,,,,,,,,,,,,,,,,,,,,320,,,,,,,,,,,,9,800,,,,,,,40,4,,,,
6938,Sweet Chilli & Sesame Meat-Free Chicken Udon,20',,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,16,,,,,,2,160,80,30,30,330,800,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
8865,Meat-Free Mince Bulgogi With Rice And Spicy Carrot Pickle,20',,,,,,,,,,,,,,,,,,,,,,,,,,,,,400,,,30,,,,,,,160,50,30,30,,,,,,,,2,30,,,,,,,,,,,,,,,,,,16,,600,,,,,,,,,,,,,,,,,,
6536,Hoisin Meat-Free Mince & Mushroom Rice Bowl,20',,,,,,,,,,,,,,,,,,,,,,,,2,,,,,400,,2,60,,,,80,,,,,,30,,,,,,,,,,,,,,,,,,,,,,,,,,,,,600,,,,,,,,160,,,,,,,,,,
9128,"Chickpea, Spinach & Coconut Curry With Rice",20',,,,,40,28,,32,100,800,,11,,,,,250,,,,,,,,,,,,,,,,,,,,,,240,,,30,,,,,,,,,,,,,,,,,,,,,,,,,,,,,600,,,,,9,,,,,,,,,,,,,
5870,Satay Sweet Potato & Kale Curry,50',2,,,10,,28,,32,,,,22,,,,,,,,,,,2,,,,,,,,,,,,,,,,,,,,,,,2,,,,,,,104,,,,,,,,,,,,,200,160,160,,,,,,,,,,,,,,,,,,,,,
9539,Chickpea Tikka Masala with Fragrant Rice,60',4,4,4,20,40,28,28,64,100,800,260,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
9632,"Butternut Squash, Lentil & Coconut Dal",50',2,,2,20,,,,,100,,,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2,,,,,640,,200,,,,,,,,,,9,800,,,,,,,,,,,,
5722,Plant-Based Aubergine & Squash Risotto,50',2,,4,,,,,,,,,22,10,,,,,,,30,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2,2,30,40,320,320,30,,,,,,,,,,,,,,,,,,,,,,,,
7939,3 Cheese Veg-Packed Pasta Bake,60',,,4,,,,,,,,,22,20,250,2,70,250,2,300,30,60,420,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
9702,Meat-Free Chicken Teriyaki Tray Bake,60',,,,,,,,,,,100,,,,,,,,,,,,,,,,,,,,,30,,,,,160,,,,,,330,,2,2,50,6,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
6670,Sticky Chilli Meat-Free Mince Burritos With Lime Mayo,40',,2,,,,,,,,,200,,,,,80,,,,,,,2,2,10,50,60,40,400,12,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
8686,Spicy Sichuan-Style Vegetable Noodle Bowl,40',,,6,,,,,,,,,,,,,,,,,,,,,,,,,,,,,60,,160,,,,2,,,30,,,,,,,,5,2,30,320,52,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
5634,Spicy Hoisin Meat-Free Mince With Ginger & Sesame Greens,40',,,4,,,,,,,,200,,,,,,,,,,,,,,,,,,400,,2,32,160,160,20,80,320,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,`;

function parseCSVAndSeed() {
    const lines = csvData.trim().split('\n');
    const headers = lines[0].split(',').map(h => h.trim());

    // We start from index 3 because 0,1,2 are Number, Name, Time
    const ingredientHeaders = headers.slice(3).filter(h => h); // Filter empty headers

    const recipes = [];

    // Helper to extract unit from header "Name (unit)"
    const parseMeta = (header) => {
        const match = header.match(/(.*)\s\((.*)\)/);
        if (match) {
            return { name: match[1].trim(), unit: match[2].trim() };
        }
        return { name: header, unit: 'units' };
    };

    // Iterate data lines
    for (let i = 1; i < lines.length; i++) {
        // Handle CSV split respecting quotes not implemented fully here for simplicity, 
        // assuming standard CSV but specific fix for "Chickpea, Spinach..." title
        // A simple regex split or just robust library would be better, but we do custom:

        let row = [];
        let inQuote = false;
        let buffer = '';
        for (let char of lines[i]) {
            if (char === '"') { inQuote = !inQuote; continue; }
            if (char === ',' && !inQuote) { row.push(buffer); buffer = ''; continue; }
            buffer += char;
        }
        row.push(buffer); // last item

        if (row.length < 3) continue;

        const name = row[1];
        const ingredients = [];

        // Check each ingredient column (offset by 3)
        for (let j = 0; j < ingredientHeaders.length; j++) {
            const rawValue = row[j + 3];
            if (rawValue && rawValue.trim() !== '') {
                const header = ingredientHeaders[j];
                const meta = parseMeta(header);

                ingredients.push({
                    name: meta.name,
                    quantity: parseFloat(rawValue.trim()),
                    unit: meta.unit
                });
            }
        }

        if (ingredients.length > 0) {
            recipes.push({
                id: 'imported-' + Math.random().toString(36).substr(2, 9),
                name: name,
                ingredients: ingredients
            });
        }
    }

    // Save to LocalStorage
    const existing = JSON.parse(localStorage.getItem('recipes') || '[]');
    const combined = [...existing, ...recipes];
    localStorage.setItem('recipes', JSON.stringify(combined));

    alert(`Imported ${recipes.length} new recipes! Reloading...`);
    location.reload();
}

window.parseCSVAndSeed = parseCSVAndSeed;

// Check if we need to seed (simple check: if URL has ?import=true)
if (window.location.search.includes('import=true')) {
    parseCSVAndSeed();
}
